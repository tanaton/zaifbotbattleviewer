!function(t){function e(e){for(var a,r,h=e[0],o=e[1],c=e[2],l=0,p=[];l<h.length;l++)r=h[l],Object.prototype.hasOwnProperty.call(s,r)&&s[r]&&p.push(s[r][0]),s[r]=0;for(a in o)Object.prototype.hasOwnProperty.call(o,a)&&(t[a]=o[a]);for(d&&d(e);p.length;)p.shift()();return n.push.apply(n,c||[]),i()}function i(){for(var t,e=0;e<n.length;e++){for(var i=n[e],a=!0,h=1;h<i.length;h++){var o=i[h];0!==s[o]&&(a=!1)}a&&(n.splice(e--,1),t=r(r.s=i[0]))}return t}var a={},s={1:0},n=[];function r(e){if(a[e])return a[e].exports;var i=a[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=t,r.c=a,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(i,a,function(e){return t[e]}.bind(null,a));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var h=window.webpackJsonp=window.webpackJsonp||[],o=h.push.bind(h);h.push=e,h=h.slice();for(var c=0;c<h.length;c++)e(h[c]);var d=o;n.push([66,0]),i()}({66:function(t,e,i){"use strict";i.r(e);var a=i(0),s=i(7);const n="btc_jpy",r="xem_jpy",h="mona_jpy",o="bch_jpy",c="eth_jpy";const d="▼",l="▲";const p="ask",u="bid";function m(t){switch(t){case p:case u:return!0}return!1}const g="Asks",y="Bids",v=a.f(".1f");function f(t){return t instanceof Object!=!1&&(!1!==function(t){switch(t){case n:case r:case h:case o:case c:return!0}return!1}(t.currency_pair)&&(!!t.timestamp&&(t.asks instanceof Array!=!1&&(!1!==t.asks.every(t=>2===t.length)&&(t.bids instanceof Array!=!1&&(!1!==t.bids.every(t=>2===t.length)&&(t.trades instanceof Array!=!1&&(!1!==t.trades.every(t=>m(t.trade_type))&&(t.last_price instanceof Object!=!1&&!1!==m(t.last_price.action))))))))))}class x{constructor(){var t;this.margin={top:10,right:10,bottom:20,left:60},this.data=[],this.candlewidth=10;const e=document.getElementById("svgcandlestick");this.width=null!==(t=null==e?void 0:e.offsetWidth)&&void 0!==t?t:850,this.width=this.width-this.margin.left-this.margin.right,this.height=Math.min(this.width,430),this.xCandle=a.j().domain([0,0]).range([0,this.width]),this.yCandle=a.h().domain([1e7,-1e7]).range([this.height,0]),this.yVolume=a.h().domain([1e9,-1e9]).range([this.height,0]),this.xCandleAxis=a.b(this.xCandle).tickSizeOuter(this.height).tickSizeInner(this.height).tickFormat(a.l("%Y/%m/%d")).tickPadding(7).ticks(3),this.yCandleAxis=a.c(this.yCandle).tickSizeOuter(-this.width).tickSizeInner(-this.width).tickPadding(7).ticks(5),this.yVolumeAxis=a.d(this.yVolume).tickPadding(7).ticks(5),this.color=a.i().range(["#b94047","#47ba41","#4147ba","#bab441","#41bab4","#b441ba"]),this.rect_stroke=t=>t.open>t.close?this.color("red"):this.color("green"),this.color.domain(["red","green","blue"]),this.svg=a.k("#svgcandlestick").append("svg"),this.svg.attr("width",this.width+this.margin.left+this.margin.right+10).attr("height",this.height+this.margin.top+this.margin.bottom+10)}dispose(){const t=document.getElementById("svgcandlestick");t&&(t.innerHTML="")}addData(t){const e=this.data;for(const i of t){if(i.date.length<8)continue;const t=parseInt(i.date.substr(0,4),10),a=parseInt(i.date.substr(4,2),10),s=parseInt(i.date.substr(6,2),10);e.push({date:new Date(t,a-1,s),open:261634*i.open,close:261634*i.close,high:261634*i.high,low:261634*i.low,vwap:261634*i.vwap,volume:i.volume})}e.length>0&&(this.candlewidth=Math.ceil((this.width-10)/e.length))}static lowMinFunc(t,e){return t<e.low?t:e.low}static highMaxFunc(t,e){return t>e.high?t:e.high}static volumeMinFunc(t,e){return t<e.volume?t:e.volume}static volumeMaxFunc(t,e){return t>e.volume?t:e.volume}updateDepthDomain(){const t=this.xCandle.domain(),e=this.yCandle.domain(),i=this.yVolume.domain(),a=this.data,s=a.length;t[0]=a[0].date,t[1]=a[s-1].date,e[0]=a.reduce(x.lowMinFunc,1e7),e[1]=a.reduce(x.highMaxFunc,-1e7),i[0]=0,i[1]=3*a.reduce(x.volumeMaxFunc,-1e9),this.xCandle.domain(t),this.yCandle.domain(e).nice(),this.yVolume.domain(i).nice()}draw(){const t=this.svg.selectAll(".rect_volume").data(this.data).enter().append("g").attr("transform",`translate(${this.margin.left},${this.margin.top})`);t.append("rect").style("fill","#000").attr("opacity",.1).attr("x",t=>this.xCandle(t.date)-this.candlewidth/2).attr("y",t=>this.yVolume(t.volume)).attr("width",this.candlewidth).attr("height",t=>Math.abs(this.yVolume(0)-this.yVolume(t.volume))),t.append("rect").style("fill",this.rect_stroke).attr("x",t=>this.xCandle(t.date)-this.candlewidth/2).attr("y",t=>Math.min(this.yCandle(t.open),this.yCandle(t.close))).attr("width",this.candlewidth).attr("height",t=>Math.max(Math.abs(this.yCandle(t.open)-this.yCandle(t.close)),2)),t.append("line").attr("x1",t=>this.xCandle(t.date)).attr("y1",t=>this.yCandle(t.high)).attr("x2",t=>this.xCandle(t.date)).attr("y2",t=>this.yCandle(t.low)).attr("stroke-width",2).style("stroke",this.rect_stroke),t.append("circle").attr("cx",t=>this.xCandle(t.date)).attr("cy",t=>this.yCandle(t.vwap)).attr("r",Math.min(Math.max(this.candlewidth-1,1),5)).style("fill","black"),this.svg.append("line").attr("transform",`translate(${this.margin.left},${this.margin.top})`).attr("x1",this.xCandle(this.xCandle.domain()[0])).attr("y1",this.yCandle(26e5)).attr("x2",this.xCandle(this.xCandle.domain()[1])).attr("y2",this.yCandle(26e5)).attr("stroke-width",1).style("stroke","#4147ba"),this.svg.selectAll(".x.axis").data([this.data[0]]).enter().append("g").attr("class","x axis").attr("transform",`translate(${this.margin.left},${this.margin.top})`).call(this.xCandleAxis),this.svg.selectAll(".y.axis").data([this.data[0]]).enter().append("g").attr("class","y axis").attr("transform",`translate(${this.margin.left},${this.margin.top})`).call(this.yCandleAxis)}}class w{constructor(){var t;this.margin={top:10,right:10,bottom:20,left:60},this.data=[{name:g,values:[]},{name:y,values:[]}];const e=document.getElementById("svgdepth");this.width=null!==(t=null==e?void 0:e.offsetWidth)&&void 0!==t?t:850,this.width=this.width-this.margin.left-this.margin.right,this.height=260-this.margin.top-this.margin.bottom,this.x=a.h().domain([0,0]).range([0,this.width]),this.y=a.h().domain([1e7,-1e7]).range([this.height,0]),this.xAxis=a.b(this.x).tickSizeOuter(-this.height).tickSizeInner(-this.height).tickPadding(7).ticks(5),this.yAxis=a.c(this.y).tickSizeOuter(-this.width).tickSizeInner(-this.width).tickFormat(t=>{let e;return e=t>=1e6?v(t/1e6)+"M":(t/1e3|0)+"k",e}).tickPadding(7).ticks(2),this.line=a.g().curve(a.e).x(t=>this.x(t.price)).y(t=>this.y(t.depth)),this.path_d=t=>this.line(t.values),this.line_area=a.a().curve(a.e).x(t=>this.x(t.price)).y0(()=>this.y(0)).y1(t=>this.y(t.depth)),this.area_d=t=>this.line_area(t.values),this.color=a.i().range(["#b94047","#47ba41","#4147ba","#bab441","#41bab4","#b441ba"]),this.path_stroke=t=>this.color(t.name),this.color.domain([g,y]),this.svg=a.k("#svgdepth").append("svg"),this.svg.attr("width",this.width+this.margin.left+this.margin.right+10).attr("height",this.height+this.margin.top+this.margin.bottom+10),this.graph=this.svg.selectAll(".depth").data(this.data).enter().append("g").attr("transform",`translate(${this.margin.left},${this.margin.top})`).attr("class","depth"),this.graph_area=this.svg.selectAll(".depth_area").data(this.data).enter().append("g").attr("transform",`translate(${this.margin.left},${this.margin.top})`).attr("class","depth_area"),this.graph.append("path").attr("class","line").style("stroke",this.path_stroke),this.graph_area.append("path").attr("class","depth_area_path").attr("opacity",.3).style("fill",this.path_stroke),this.svg.append("g").attr("class","x axis depth-x").attr("transform",`translate(${this.margin.left},${this.height+this.margin.top})`).call(this.xAxis),this.svg.append("g").attr("class","y axis depth-y").attr("transform",`translate(${this.margin.left},${this.margin.top})`).call(this.yAxis)}dispose(){const t=document.getElementById("svgdepth");t&&(t.innerHTML="")}addData(t){[t.asks,t.bids].forEach((t,e)=>{if(t){let i=0;this.data[e].values=t.map(t=>(i+=t[0]*t[1],{price:t[0],depth:i})),this.data[e].values.unshift({price:t[0][0],depth:0})}})}static depthMaxFunc(t,e){return t>e.depth?t:e.depth}updateDepthDomain(){const t=this.x.domain(),e=this.y.domain();t[0]=this.data[1].values.reduce((t,e)=>t<e.price?t:e.price,1e7),t[1]=this.data[0].values.reduce((t,e)=>t>e.price?t:e.price,-1e7),e[0]=0,e[1]=Math.max(this.data[0].values.reduce(w.depthMaxFunc,-1e7),this.data[1].values.reduce(w.depthMaxFunc,-1e7)),this.x.domain(t),this.y.domain(e).nice()}draw(){this.graph.select("path").attr("d",this.path_d),this.svg.select(".x.axis.depth-x").call(this.xAxis),this.svg.select(".y.axis.depth-y").call(this.yAxis),this.graph_area.select("path").attr("d",this.area_d)}}class b{constructor(t,e){this.tid=window.setInterval(t,e)}stop(){this.tid>0&&(window.clearInterval(this.tid),this.tid=0)}}class _{constructor(){this.ws=new WebSocket("wss://ws.zaif.jp/stream?currency_pair="+r),this.ws.addEventListener("open",()=>{console.log("接続しました。")}),this.ws.addEventListener("error",t=>{console.error("WebSocket Error "+t)}),this.ws.addEventListener("close",()=>{console.log("切断しました。")}),this.ws.addEventListener("message",t=>{const e=JSON.parse(t.data);f(e)&&this.update(e)}),this.candlestick=new x,_.ajax("/api/zaif/1/ticks/xem_jpy").then(t=>{this.candlestick.addData(t),this.candlestick.updateDepthDomain(),this.candlestick.draw()}).catch(t=>{console.error(t)}),this.depth=new w;const t=()=>{_.ajax("/api/zaif/1/depth/xem_jpy").then(t=>{this.depth.addData(t),this.depth.updateDepthDomain(),this.depth.draw()}).catch(t=>{console.error(t)})};t(),this.timer=new b(t,6e4)}dispose(){var t,e,i,a;null===(t=this.ws)||void 0===t||t.close(),null===(e=this.timer)||void 0===e||e.stop(),null===(i=this.depth)||void 0===i||i.dispose(),null===(a=this.candlestick)||void 0===a||a.dispose()}static getDirection(t){return t===p?d:l}update(t){k.last_trade.price=t.last_price.price.toLocaleString(void 0,{maximumFractionDigits:5}),k.last_trade.action=_.getDirection(t.last_price.action),k.last_trade.type=t.last_price.action;const e=t.last_price.price*k.currency_number;k.asset_now=Math.round(e).toLocaleString(void 0,{maximumFractionDigits:5});const i=e/(k.currency_number*k.purchase_price);k.asset_per=(Math.round(1e4*i)/100).toLocaleString(void 0,{maximumFractionDigits:5}),document.title=k.last_trade.action+" "+k.asset_now+` (${k.asset_per}%) - 資産の様子`}static ajax(t){const e=new AbortController;return Promise.race([fetch(t,{signal:e.signal}),new Promise((t,i)=>{setTimeout(()=>{e.abort(),i(new Error("timeout"))},1e4)})]).then(t=>{if(t.ok)return t.json();throw new Error(t.statusText)})}}const k={last_trade:{price:"0",action:l,type:u},asset_now:"0",asset_per:"0",currency_number:261634,purchase_price:26e5/261634,currencys:{btc_jpy:{name:"btc/jpy",hash:"/zaif/#btc_jpy",active:""},xem_jpy:{name:"xem/jpy",hash:"/zaif/#xem_jpy",active:""},mona_jpy:{name:"mona/jpy",hash:"/zaif/#mona_jpy",active:""},bch_jpy:{name:"bch/jpy",hash:"/zaif/#bch_jpy",active:""},eth_jpy:{name:"eth/jpy",hash:"/zaif/#eth_jpy",active:""}}};new s.a({el:"#container",data:k}),new _}});
//# sourceMappingURL=myasset.js.map