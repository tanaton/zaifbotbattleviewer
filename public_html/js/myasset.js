!function(t){function e(e){for(var i,n,h=e[0],o=e[1],d=e[2],c=0,p=[];c<h.length;c++)n=h[c],Object.prototype.hasOwnProperty.call(s,n)&&s[n]&&p.push(s[n][0]),s[n]=0;for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(t[i]=o[i]);for(l&&l(e);p.length;)p.shift()();return r.push.apply(r,d||[]),a()}function a(){for(var t,e=0;e<r.length;e++){for(var a=r[e],i=!0,h=1;h<a.length;h++){var o=a[h];0!==s[o]&&(i=!1)}i&&(r.splice(e--,1),t=n(n.s=a[0]))}return t}var i={},s={1:0},r=[];function n(e){if(i[e])return i[e].exports;var a=i[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=t,n.c=i,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(a,i,function(e){return t[e]}.bind(null,i));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="";var h=window.webpackJsonp=window.webpackJsonp||[],o=h.push.bind(h);h.push=e,h=h.slice();for(var d=0;d<h.length;d++)e(h[d]);var l=o;r.push([66,0]),a()}({66:function(t,e,a){"use strict";a.r(e);var i=a(0),s=a(7);function r(t){switch(t){case"ask":case"bid":return!0}return!1}const n=i.f(".1f");class h{constructor(){var t;this.margin={top:10,right:10,bottom:20,left:60},this.data=[],this.candlewidth=10;const e=document.getElementById("svgcandlestick");this.width=null!==(t=null==e?void 0:e.offsetWidth)&&void 0!==t?t:850,this.width=this.width-this.margin.left-this.margin.right,this.height=Math.min(this.width,430),this.xCandle=i.j().domain([0,0]).range([0,this.width]),this.yCandle=i.h().domain([1e7,-1e7]).range([this.height,0]),this.yVolume=i.h().domain([1e9,-1e9]).range([this.height,0]),this.xCandleAxis=i.b(this.xCandle).tickSizeOuter(this.height).tickSizeInner(this.height).tickFormat(i.l("%Y/%m/%d")).tickPadding(7).ticks(3),this.yCandleAxis=i.c(this.yCandle).tickSizeOuter(-this.width).tickSizeInner(-this.width).tickPadding(7).ticks(5),this.yVolumeAxis=i.d(this.yVolume).tickPadding(7).ticks(5),this.color=i.i().range(["#b94047","#47ba41","#4147ba","#bab441","#41bab4","#b441ba"]),this.rect_stroke=t=>t.open>t.close?this.color("red"):this.color("green"),this.color.domain(["red","green","blue"]),this.svg=i.k("#svgcandlestick").append("svg"),this.svg.attr("width",this.width+this.margin.left+this.margin.right+10).attr("height",this.height+this.margin.top+this.margin.bottom+10)}dispose(){const t=document.getElementById("svgcandlestick");t&&(t.innerHTML="")}addData(t){const e=this.data;for(const a of t){if(a.date.length<8)continue;const t=parseInt(a.date.substr(0,4),10),i=parseInt(a.date.substr(4,2),10),s=parseInt(a.date.substr(6,2),10);e.push({date:new Date(t,i-1,s),open:261634*a.open,close:261634*a.close,high:261634*a.high,low:261634*a.low,vwap:261634*a.vwap,volume:a.volume})}e.length>0&&(this.candlewidth=Math.ceil((this.width-10)/e.length))}static lowMinFunc(t,e){return t<e.low?t:e.low}static highMaxFunc(t,e){return t>e.high?t:e.high}static volumeMinFunc(t,e){return t<e.volume?t:e.volume}static volumeMaxFunc(t,e){return t>e.volume?t:e.volume}updateDepthDomain(){const t=this.xCandle.domain(),e=this.yCandle.domain(),a=this.yVolume.domain(),i=this.data,s=i.length;t[0]=i[0].date,t[1]=i[s-1].date,e[0]=i.reduce(h.lowMinFunc,1e7),e[1]=i.reduce(h.highMaxFunc,-1e7),a[0]=0,a[1]=3*i.reduce(h.volumeMaxFunc,-1e9),this.xCandle.domain(t),this.yCandle.domain(e).nice(),this.yVolume.domain(a).nice()}draw(){const t=this.svg.selectAll(".rect_volume").data(this.data).enter().append("g").attr("transform",`translate(${this.margin.left},${this.margin.top})`);t.append("rect").style("fill","#000").attr("opacity",.1).attr("x",t=>this.xCandle(t.date)-this.candlewidth/2).attr("y",t=>this.yVolume(t.volume)).attr("width",this.candlewidth).attr("height",t=>Math.abs(this.yVolume(0)-this.yVolume(t.volume))),t.append("rect").style("fill",this.rect_stroke).attr("x",t=>this.xCandle(t.date)-this.candlewidth/2).attr("y",t=>Math.min(this.yCandle(t.open),this.yCandle(t.close))).attr("width",this.candlewidth).attr("height",t=>Math.max(Math.abs(this.yCandle(t.open)-this.yCandle(t.close)),2)),t.append("line").attr("x1",t=>this.xCandle(t.date)).attr("y1",t=>this.yCandle(t.high)).attr("x2",t=>this.xCandle(t.date)).attr("y2",t=>this.yCandle(t.low)).attr("stroke-width",2).style("stroke",this.rect_stroke),t.append("circle").attr("cx",t=>this.xCandle(t.date)).attr("cy",t=>this.yCandle(t.vwap)).attr("r",Math.min(Math.max(this.candlewidth-1,1),5)).style("fill","black"),this.svg.append("line").attr("transform",`translate(${this.margin.left},${this.margin.top})`).attr("x1",this.xCandle(this.xCandle.domain()[0])).attr("y1",this.yCandle(26e5)).attr("x2",this.xCandle(this.xCandle.domain()[1])).attr("y2",this.yCandle(26e5)).attr("stroke-width",1).style("stroke","#4147ba"),this.svg.selectAll(".x.axis").data([this.data[0]]).enter().append("g").attr("class","x axis").attr("transform",`translate(${this.margin.left},${this.margin.top})`).call(this.xCandleAxis),this.svg.selectAll(".y.axis").data([this.data[0]]).enter().append("g").attr("class","y axis").attr("transform",`translate(${this.margin.left},${this.margin.top})`).call(this.yCandleAxis)}}class o{constructor(){var t;this.margin={top:10,right:10,bottom:20,left:60},this.data=[{name:"Asks",values:[]},{name:"Bids",values:[]}];const e=document.getElementById("svgdepth");this.width=null!==(t=null==e?void 0:e.offsetWidth)&&void 0!==t?t:850,this.width=this.width-this.margin.left-this.margin.right,this.height=260-this.margin.top-this.margin.bottom,this.x=i.h().domain([0,0]).range([0,this.width]),this.y=i.h().domain([1e7,-1e7]).range([this.height,0]),this.xAxis=i.b(this.x).tickSizeOuter(-this.height).tickSizeInner(-this.height).tickPadding(7).ticks(5),this.yAxis=i.c(this.y).tickSizeOuter(-this.width).tickSizeInner(-this.width).tickFormat(t=>{let e;return e=t>=1e6?n(t/1e6)+"M":(t/1e3|0)+"k",e}).tickPadding(7).ticks(2),this.line=i.g().curve(i.e).x(t=>this.x(t.price)).y(t=>this.y(t.depth)),this.path_d=t=>this.line(t.values),this.line_area=i.a().curve(i.e).x(t=>this.x(t.price)).y0(()=>this.y(0)).y1(t=>this.y(t.depth)),this.area_d=t=>this.line_area(t.values),this.color=i.i().range(["#b94047","#47ba41","#4147ba","#bab441","#41bab4","#b441ba"]),this.path_stroke=t=>this.color(t.name),this.color.domain(["Asks","Bids"]),this.svg=i.k("#svgdepth").append("svg"),this.svg.attr("width",this.width+this.margin.left+this.margin.right+10).attr("height",this.height+this.margin.top+this.margin.bottom+10),this.graph=this.svg.selectAll(".depth").data(this.data).enter().append("g").attr("transform",`translate(${this.margin.left},${this.margin.top})`).attr("class","depth"),this.graph_area=this.svg.selectAll(".depth_area").data(this.data).enter().append("g").attr("transform",`translate(${this.margin.left},${this.margin.top})`).attr("class","depth_area"),this.graph.append("path").attr("class","line").style("stroke",this.path_stroke),this.graph_area.append("path").attr("class","depth_area_path").attr("opacity",.3).style("fill",this.path_stroke),this.svg.append("g").attr("class","x axis depth-x").attr("transform",`translate(${this.margin.left},${this.height+this.margin.top})`).call(this.xAxis),this.svg.append("g").attr("class","y axis depth-y").attr("transform",`translate(${this.margin.left},${this.margin.top})`).call(this.yAxis)}dispose(){const t=document.getElementById("svgdepth");t&&(t.innerHTML="")}addData(t){[t.asks,t.bids].forEach((t,e)=>{if(t){let a=0;this.data[e].values=t.map(t=>(a+=t[0]*t[1],{price:t[0],depth:a})),this.data[e].values.unshift({price:t[0][0],depth:0})}})}static depthMaxFunc(t,e){return t>e.depth?t:e.depth}updateDepthDomain(){const t=this.x.domain(),e=this.y.domain();t[0]=this.data[1].values.reduce((t,e)=>t<e.price?t:e.price,1e7),t[1]=this.data[0].values.reduce((t,e)=>t>e.price?t:e.price,-1e7),e[0]=0,e[1]=Math.max(this.data[0].values.reduce(o.depthMaxFunc,-1e7),this.data[1].values.reduce(o.depthMaxFunc,-1e7)),this.x.domain(t),this.y.domain(e).nice()}draw(){this.graph.select("path").attr("d",this.path_d),this.svg.select(".x.axis.depth-x").call(this.xAxis),this.svg.select(".y.axis.depth-y").call(this.yAxis),this.graph_area.select("path").attr("d",this.area_d)}}class d{constructor(t,e){this.tid=window.setInterval(t,e)}stop(){this.tid>0&&(window.clearInterval(this.tid),this.tid=0)}}class l{constructor(){this.ws=new WebSocket("wss://ws.zaif.jp/stream?currency_pair=xem_jpy"),this.ws.onopen=()=>{console.log("接続しました。")},this.ws.onerror=t=>{console.error("WebSocket Error "+t)},this.ws.onclose=()=>{console.log("切断しました。")},this.ws.onmessage=t=>{const e=JSON.parse(t.data);var a;(a=e)instanceof Object!=0&&!1!==function(t){switch(t){case"btc_jpy":case"xem_jpy":case"mona_jpy":case"bch_jpy":case"eth_jpy":return!0}return!1}(a.currency_pair)&&a.timestamp&&a.asks instanceof Array!=0&&!1!==a.asks.every(t=>2===t.length)&&a.bids instanceof Array!=0&&!1!==a.bids.every(t=>2===t.length)&&a.trades instanceof Array!=0&&!1!==a.trades.every(t=>r(t.trade_type))&&a.last_price instanceof Object!=0&&!1!==r(a.last_price.action)&&this.update(e)},this.candlestick=new h,l.ajax("/api/zaif/1/ticks/xem_jpy",t=>{this.candlestick.addData(JSON.parse(t.responseText)),this.candlestick.updateDepthDomain(),this.candlestick.draw()}),this.depth=new o;const t=()=>{l.ajax("/api/zaif/1/depth/xem_jpy",t=>{this.depth.addData(JSON.parse(t.responseText)),this.depth.updateDepthDomain(),this.depth.draw()})};t(),this.timer=new d(t,6e4)}dispose(){var t,e,a,i;null===(t=this.ws)||void 0===t||t.close(),null===(e=this.timer)||void 0===e||e.stop(),null===(a=this.depth)||void 0===a||a.dispose(),null===(i=this.candlestick)||void 0===i||i.dispose()}static getDirection(t){return"ask"===t?"▼":"▲"}update(t){c.last_trade.price=t.last_price.price.toLocaleString(),c.last_trade.action=l.getDirection(t.last_price.action),c.last_trade.type=t.last_price.action;const e=t.last_price.price*c.currency_number;c.asset_now=Math.round(e).toLocaleString();const a=e/(c.currency_number*c.purchase_price);c.asset_per=(Math.round(1e4*a)/100).toLocaleString(),document.title=c.last_trade.action+" "+c.asset_now+` (${c.asset_per}%) - 資産の様子`}static ajax(t,e){const a=new XMLHttpRequest;a.ontimeout=()=>{console.error(`The request for ${t} timed out.`)},a.onload=t=>{4===a.readyState&&(200===a.status?e(a):console.error(a.statusText))},a.onerror=t=>{console.error(a.statusText)},a.open("GET",t,!0),a.timeout=5e3,a.send(null)}}const c={last_trade:{price:"0",action:"▲",type:"bid"},asset_now:"0",asset_per:"0",currency_number:261634,purchase_price:26e5/261634,currencys:{btc_jpy:{name:"btc/jpy",hash:"/zaif/#btc_jpy",active:""},xem_jpy:{name:"xem/jpy",hash:"/zaif/#xem_jpy",active:""},mona_jpy:{name:"mona/jpy",hash:"/zaif/#mona_jpy",active:""},bch_jpy:{name:"bch/jpy",hash:"/zaif/#bch_jpy",active:""},eth_jpy:{name:"eth/jpy",hash:"/zaif/#eth_jpy",active:""}}};new s.a({el:"#container",data:c}),new l}});
//# sourceMappingURL=myasset.js.map